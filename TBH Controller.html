<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TBH Controller &mdash; LouLib  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/collapsible-lists/css/tree_view.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/collapsible-lists/js/CollapsibleLists.compressed.js"></script>
        <script src="_static/collapsible-lists/js/apply-collapsible-lists.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="LQR Controller" href="LQR%20Controller.html" />
    <link rel="prev" title="PID Controller" href="PID%20Controller.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            LouLib
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Controllers</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="PID%20Controller.html">PID Controller</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">TBH Controller</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#creating-a-tbhcontroller">Creating a TBHController</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-the-tbh-controller">Using the TBH Controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tuning-the-tbh-controller">Tuning the TBH Controller</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="LQR%20Controller.html">LQR Controller</a></li>
<li class="toctree-l1"><a class="reference internal" href="RAMSETE%20Controller.html">RAMSETE Controller</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Odometry</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Odometry%20Sensors.html">Odometry Sensors</a></li>
<li class="toctree-l1"><a class="reference internal" href="Using%20Odometry.html">Using Odometry</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Paths</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Trajectory.html">Trajectory</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Math</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Vector.html">Vector</a></li>
<li class="toctree-l1"><a class="reference internal" href="Matrix.html">Matrix</a></li>
<li class="toctree-l1"><a class="reference internal" href="Point2D%20and%20Pose2D.html">Point2D and Pose2D</a></li>
<li class="toctree-l1"><a class="reference internal" href="Constants%20and%20Functions.html">Constants and Functions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Units</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Unit%20System.html">Unit System</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Filters</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="SMA%20Filter.html">Simple Moving Average (SMA) Filter</a></li>
<li class="toctree-l1"><a class="reference internal" href="SMM%20Filter.html">Simple Moving Median (SMM) Filter</a></li>
<li class="toctree-l1"><a class="reference internal" href="EWMA%20Filter.html">Exponentially-Weighted Moving Average (EWMA) Filter</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Utility</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Logger.html">Logger</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api/library_root.html">Library API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">LouLib</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">TBH Controller</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/TBH Controller.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="tbh-controller">
<h1>TBH Controller<a class="headerlink" href="#tbh-controller" title="Permalink to this headline"></a></h1>
<p>The <code class="code docutils literal notranslate"><span class="pre">TBHController</span></code> class is used to create a Take-Back-Half controller,
a purely integral-based controller, good for velocity control applications.</p>
<p>This class handles all of the feedback loop calculation.</p>
<section id="creating-a-tbhcontroller">
<h2>Creating a TBHController<a class="headerlink" href="#creating-a-tbhcontroller" title="Permalink to this headline"></a></h2>
<p>The constructor for <code class="code docutils literal notranslate"><span class="pre">TBHController</span></code> requires the TBH gain: <code class="code docutils literal notranslate"><span class="pre">k</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//Create a new TBH Controller with gain k = 0.001;</span>
<span class="n">LouLib</span><span class="o">::</span><span class="n">Controllers</span><span class="o">::</span><span class="n">TBHController</span><span class="w"> </span><span class="nf">controller</span><span class="p">(</span><span class="mf">0.001</span><span class="p">);</span>
</pre></div>
</div>
<p>The above code will create a working TBH controller, but the <code class="code docutils literal notranslate"><span class="pre">TBHController</span></code>
class also contains multiple methods to configure the controller to provide more
functionality.</p>
<p><strong>Set Delta Time</strong></p>
<blockquote>
<div><p>The <code class="code docutils literal notranslate"><span class="pre">setDeltaTime</span></code> method takes a <code class="code docutils literal notranslate"><span class="pre">LouLib::Units::Time</span></code> that represents
how much time is between each controller loop. If this value is not set, this value
defaults to 10 milliseconds.</p>
</div></blockquote>
<p><strong>Set Setpoint</strong></p>
<blockquote>
<div><p>The <code class="code docutils literal notranslate"><span class="pre">setSetpoint</span></code> method is used to set the setpoint, or target value, for
the controller. If this value is not set, the value defaults to zero.</p>
</div></blockquote>
<p><strong>Set Output Range</strong></p>
<blockquote>
<div><p>The <code class="code docutils literal notranslate"><span class="pre">setOutputRange</span></code> method is used to set the minimum and maximum controller
outputs. If the output range is not set, it will default to negative infinity to
infinity, meaning the controller can output any value.</p>
</div></blockquote>
<p>Below is an example of creating a TBH controller using the configuration methods:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//Create a new TBH Controller with gain k = 0.001;</span>
<span class="n">LouLib</span><span class="o">::</span><span class="n">Controllers</span><span class="o">::</span><span class="n">TBHController</span><span class="w"> </span><span class="nf">controller</span><span class="p">(</span><span class="mf">0.001</span><span class="p">);</span>

<span class="c1">//Set Delta Time to 20 milliseconds</span>
<span class="n">controller</span><span class="p">.</span><span class="n">setDeltaTime</span><span class="p">(</span><span class="mi">20</span><span class="n">_ms</span><span class="p">);</span>

<span class="c1">//Set the controller setpoint</span>
<span class="n">controller</span><span class="p">.</span><span class="n">setSetpoint</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>

<span class="c1">//Set output range to VEX motor voltage range in milliVolts</span>
<span class="n">controller</span><span class="p">.</span><span class="n">setOutputRange</span><span class="p">(</span><span class="mi">-12000</span><span class="p">,</span><span class="w"> </span><span class="mi">12000</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="using-the-tbh-controller">
<h2>Using the TBH Controller<a class="headerlink" href="#using-the-tbh-controller" title="Permalink to this headline"></a></h2>
<p>The TBH Controller can be used by calling the <code class="code docutils literal notranslate"><span class="pre">update</span></code> and <code class="code docutils literal notranslate"><span class="pre">getOutput</span></code>
methods.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The <code class="code docutils literal notranslate"><span class="pre">TBHController</span></code> assumes the <code class="code docutils literal notranslate"><span class="pre">update</span></code> method is being called
at an interval consistent with the configured period. Failure to do this will
result in unintented behavior.</p>
</div>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//create a new TBH controller</span>
<span class="n">LouLib</span><span class="o">::</span><span class="n">Controllers</span><span class="o">::</span><span class="n">TBHController</span><span class="w"> </span><span class="nf">controller</span><span class="p">(</span><span class="mf">0.001</span><span class="p">);</span>

<span class="c1">//set delta time</span>
<span class="kt">double</span><span class="w"> </span><span class="n">deltaTimeMilliseconds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
<span class="n">controller</span><span class="p">.</span><span class="n">setDeltaTime</span><span class="p">(</span><span class="n">deltaTimeMilliseconds</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">LouLib</span><span class="o">::</span><span class="n">Units</span><span class="o">::</span><span class="n">MILLISECOND</span><span class="p">);</span>

<span class="c1">//create TBH loop</span>
<span class="k">while</span><span class="p">(</span><span class="nb">true</span><span class="p">){</span>

<span class="w">        </span><span class="c1">//get sensor value</span>
<span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">sensorData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sensor</span><span class="p">.</span><span class="n">getReading</span><span class="p">();</span>

<span class="w">        </span><span class="c1">//Update TBH Controller</span>
<span class="w">        </span><span class="n">controller</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">sensorData</span><span class="p">);</span>

<span class="w">        </span><span class="c1">//Get controller output</span>
<span class="w">        </span><span class="n">motor</span><span class="p">.</span><span class="n">moveVelocity</span><span class="p">(</span><span class="n">controller</span><span class="p">.</span><span class="n">getOutput</span><span class="p">());</span>

<span class="w">        </span><span class="c1">//delay</span>
<span class="w">        </span><span class="n">pros</span><span class="o">::</span><span class="n">delay</span><span class="p">(</span><span class="n">deltaTimeMilliseconds</span><span class="p">);</span>

<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="tuning-the-tbh-controller">
<h2>Tuning the TBH Controller<a class="headerlink" href="#tuning-the-tbh-controller" title="Permalink to this headline"></a></h2>
<p>The TBH controller only contains a single gain value that needs to be tuned.
The easiest way to do this is manual tuning, which is done by trying different
gain values until the controller performance is satisfactory.</p>
<p>The TBH gain, <code class="code docutils literal notranslate"><span class="pre">k</span></code>, acts similarly to the <code class="code docutils literal notranslate"><span class="pre">kp</span></code> gain of a PID controller,
so the goal is to find the highest value of <code class="code docutils literal notranslate"><span class="pre">k</span></code> such that the system does
not oscillate.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="PID%20Controller.html" class="btn btn-neutral float-left" title="PID Controller" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="LQR%20Controller.html" class="btn btn-neutral float-right" title="LQR Controller" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Kevin Lou.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>